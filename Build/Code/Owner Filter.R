#Ownership Compiles
#Reads in the Parcel files and extracts IDs and Ownership Information
#June 27: Add in 2018-2020 but used slightly different code due to different data.

#Jeremy R. Groves
#May 30, 2024

rm(list=ls())

library(tidyverse)
library(foreign)

y<-seq(2002,2017)

for(i in y){

own_dat <- parcel %>%
  filter(PROPCLASS == "R" & 
           LIVUNIT>0 & 
           YEARBLT > 1800 &
           RESQFT > 100) %>%
  mutate(prop_add = trimws(as.character(droplevels(PROP_ADD))),
         own_add = trimws(as.character(droplevels(OWN_ADD)))) %>%
  filter(TENURE == "NOT OWNER") %>%
  mutate(OWN_ADD = str_replace_all(OWN_ADD, "P O ", "PO "),
         OWN_ADD = str_replace_all(OWN_ADD, ";", "L"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "L L C", "LLC"), 
         OWNER_NAME = str_replace_all(OWNER_NAME, "L    L    C", "LLC"), 
         OWNER_NAME = str_replace_all(OWNER_NAME, "L LC", "LLC"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "L C", "LLC"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "LL C", "LLC"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "J/T", "TRUST"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "L P", "LP"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "RD", "ROAD"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "SCHOOL SISTERSOF NOTRE DAME", "SCHOOL SISTERS OF NOTRE DAME"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "GOLF CLUB", "GOLFCLUB"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "PERS REP", "PERSONAL REPRESENTATIVE"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "VILLAGES OF", "VILLAGE OF"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "CITYOF", "CITY OF"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "GODTHE", "GOD THE"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "SALVATION ARMY CORPORATION ILLCORP", "SALVATION ARMY"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "CHURCH LLC", "CHURCH"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "A MISSOURI", "A MO"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "MISSOURI BANK", "MO BANK"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "MISSOURI BA", "MO BA"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "BANK OF ST LOUIS", "BANK OF STL"),
         OWNER_NAME = str_replace_all(OWNER_NAME, "LOAN CORP", "LOAN"),
         Corporate = case_when(str_detect(OWNER_NAME, "LLC") ~ 1,
                               str_detect(OWNER_NAME, "INC") ~1,
                               str_detect(OWNER_NAME, "LTD") ~1,
                               str_detect(OWNER_NAME, "COMPANY") ~ 1,
                               str_detect(OWNER_NAME, "RENTAL PROPERTY") ~ 1,
                               str_detect(OWNER_NAME, "PROPERTY") ~ 1,
                               str_detect(OWNER_NAME, "ACQUISITIONS") ~ 1,
                               str_detect(OWNER_NAME, "PROPERTIES") ~ 1,
                               str_detect(OWNER_NAME, "MANAGEMENT") ~ 1,
                               str_detect(OWNER_NAME, "LC") ~ 1,
                               str_detect(OWNER_NAME, "INVESTMENTS") ~ 1,
                               str_detect(OWNER_NAME, "REALTY") ~ 1,
                               str_detect(OWNER_NAME, "DEVELOPMENT") ~ 1,
                               str_detect(OWNER_NAME, "EQUITY") ~ 1,
                               str_detect(OWNER_NAME, "RENTALS") ~ 1,
                               str_detect(OWNER_NAME, "CORP") ~ 1,
                               str_detect(OWNER_NAME, "CO ") ~ 1,
                               str_detect(OWNER_NAME, "REAL ESTATE") ~ 1,
                               str_detect(OWNER_NAME, "CORPORATION") ~ 1,
                               str_detect(OWNER_NAME, "ASHFIELD ACTIVE LIVING") ~ 1,
                               str_detect(OWNER_NAME, "CASTLE POINT LIVING") ~ 1,
                               str_detect(OWNER_NAME, "BRYANTS TOWING") ~ 1,
                               str_detect(OWNER_NAME, "INVESTMENT") ~ 1,
                               str_detect(OWNER_NAME, "LEASING") ~ 1,
                               str_detect(OWNER_NAME, "INVESTORS") ~ 1,
                               str_detect(OWNER_NAME, "ENTERPRISE") ~ 1,
                               str_detect(OWNER_NAME, "REHAB") ~ 1,
                               str_detect(OWNER_NAME, "PRECISION PLUMBING SOLUTIONS") ~ 1,
                               str_detect(OWNER_NAME, "WIRELESS") ~ 1,
                               str_detect(OWNER_NAME, "AERO CHARTER") ~ 1,
                               str_detect(OWNER_NAME, "AMERITECH") ~ 1,
                               str_detect(OWNER_NAME, "AUTOMATIC ICE SYSTEMS") ~ 1,
                               str_detect(OWNER_NAME, "BABY HAVEN") ~ 1,
                               str_detect(OWNER_NAME, "CENTURY ALARM") ~ 1,
                               str_detect(OWNER_NAME, "CRESTWOOD EXECUTIVE CENTER") ~ 1,
                               str_detect(OWNER_NAME, "DOUGLASS LAND LIMITED") ~ 1,
                               str_detect(OWNER_NAME, "DRURY INN") ~ 1,
                               str_detect(OWNER_NAME, "DUBLEN HOMES") ~ 1,
                               str_detect(OWNER_NAME, "EDYS GRAND ICE CREAM") ~ 1,
                               str_detect(OWNER_NAME, "EIGHTEEN INESTMENTS") ~ 1,
                               str_detect(OWNER_NAME, "EVERGREEN EQUITIES") ~ 1,
                               str_detect(OWNER_NAME, "HICKORY CREST") ~ 1,
                               str_detect(OWNER_NAME, "NORTH MERAMEC") ~ 1,
                               str_detect(OWNER_NAME, "CAR WASH") ~ 1,
                               str_detect(OWNER_NAME, "CARWASH") ~ 1,
                               str_detect(OWNER_NAME, "FOUR SEVENTY SEVEN") ~ 1,
                               str_detect(OWNER_NAME, "GALE BUILDING & REMODELING") ~ 1,
                               str_detect(OWNER_NAME, "ATLAS TRUCK SALES") ~ 1,
                               str_detect(OWNER_NAME, "YOUDE FAMILY") ~ 1,
                               str_detect(OWNER_NAME, "H & M MACHINE SERVICE") ~ 1,
                               str_detect(OWNER_NAME, "HGS DESIGN LTD") ~ 1,
                               str_detect(OWNER_NAME, "I-44 MARINE") ~ 1,
                               str_detect(OWNER_NAME, "JIFFY LUBE") ~ 1,
                               str_detect(OWNER_NAME, "KINGS FOOD MARKET") ~ 1,
                               str_detect(OWNER_NAME, "LADUE INNERBELT EXECUTIVE CENTER") ~ 1,
                               str_detect(OWNER_NAME, "LECHNER & LECHNER LTD") ~ 1,
                               str_detect(OWNER_NAME, "CUSTOM HOMES") ~ 1,
                               str_detect(OWNER_NAME, "LONE STAR STEAKHOUSE") ~ 1,
                               str_detect(OWNER_NAME, "MIDAMERICA CENTER") ~ 1,
                               str_detect(OWNER_NAME, "NORFOLK & WESTERN RAILROAD") ~ 1,
                               str_detect(OWNER_NAME, "OUTDOOR SYSTEMS") ~ 1,
                               str_detect(OWNER_NAME, "P & A DRYWALL SUPPLY") ~ 1,
                               str_detect(OWNER_NAME, "PARK CRESTWOOD LTD") ~ 1,
                               str_detect(OWNER_NAME, "PHOENIX INTERNATIONAL") ~ 1,
                               str_detect(OWNER_NAME, "PHOENIX INTTERNATIONAL") ~ 1,
                               str_detect(OWNER_NAME, "PINE LAWN DENTAL") ~ 1,
                               str_detect(OWNER_NAME, "PIZZA INN") ~ 1,
                               str_detect(OWNER_NAME, "PLEASANT HOLLOW LTD") ~ 1,
                               str_detect(OWNER_NAME, "R MITCHELL RENOVATIONS") ~ 1,
                               str_detect(OWNER_NAME, "RED LOBSTER INNS OF AMERICA") ~ 1,
                               str_detect(OWNER_NAME, "SHERWOODS FOREST NURSERY") ~ 1,
                               str_detect(OWNER_NAME, "SPRINT PCS") ~ 1,
                               str_detect(OWNER_NAME, "REFUSE DISPOSAL SERVICE") ~ 1,
                               str_detect(OWNER_NAME, "SUTTON RESOURCES LTD") ~ 1,
                               str_detect(OWNER_NAME, "TOWNHOUSES LTD") ~ 1,
                               str_detect(OWNER_NAME, "TUCKEY & ASSOCS PHYSICAL") ~ 1,
                               str_detect(OWNER_NAME, "UNION PACIFIC SYSTEMS") ~ 1,
                               str_detect(OWNER_NAME, "WINTER BROTHERS MATERIALS") ~ 1,
                               str_detect(OWNER_NAME, "WOLFF SHOE MANUFACTURING") ~ 1,
                               TRUE ~ 0),
         Partner = case_when(str_detect(OWNER_NAME, " PARTNER ") ~ 1,
                             str_detect(OWNER_NAME, " LP ") ~ 1,
                             str_detect(OWNER_NAME, "PTNSP ") ~ 1,
                             str_detect(OWNER_NAME, "GROUP") ~ 1,
                             str_detect(OWNER_NAME, "ASSOCIATES ") ~ 1, 
                             str_detect(OWNER_NAME, " BUILDERS ") ~ 1,
                             str_detect(OWNER_NAME, "JOINT VENTURE") ~ 1,
                             str_detect(OWNER_NAME, "CHARLOTTE FREDERICK FAMILY LIMITED") ~ 1,
                             str_detect(OWNER_NAME, "CLARKSON CLAYTON CEN") ~ 1,
                             str_detect(OWNER_NAME, "EQUITABLE-CROW MIDWEST") ~ 1,
                             str_detect(OWNER_NAME, "EQUITABLE CROW MIDWEST") ~ 1,
                             str_detect(OWNER_NAME, "HIGHLAND MINI STORAGE") ~ 1,
                             str_detect(OWNER_NAME, "UNDERTAKERS") ~ 1,
                             str_detect(OWNER_NAME, "KENNETH S ROTSKOFF FAMILY") ~ 1,
                             str_detect(OWNER_NAME, "MARY DIANE GOESSLING BRYAN FAMILY") ~ 1,
                             str_detect(OWNER_NAME, "MARYVILLE CENTRE HOTEL") ~ 1,
                             str_detect(OWNER_NAME, "TERRA VENTURE BRIDGETON PROJECT") ~ 1,
                             TRUE ~ 0),
         Trust = case_when(str_detect(OWNER_NAME, "TRUST") ~ 1,
                           str_detect(OWNER_NAME, "TRS") ~ 1,
                           str_detect(OWNER_NAME, "REVOCABLE") ~ 1,
                           str_detect(OWNER_NAME, "IRREVOC") ~ 1,
                           str_detect(OWNER_NAME, "REVOC") ~ 1,
                           str_detect(OWNER_NAME, "ESTATE OF") ~ 1,
                           str_detect(OWNER_NAME, "\\s ITAF \\s") ~ 1,
                           str_detect(OWNER_NAME, "FUND") ~ 1,
                           str_detect(OWNER_NAME, "INDENTURE") ~ 1,
                           str_detect(OWNER_NAME, "PERSONAL REPRESENTATIVE") ~ 1,
                           str_detect(OWNER_NAME, "HEIRS OF") ~ 1,
                           str_detect(OWNER_NAME, "EMPLOYEESRETIREMENT") ~ 1,
                           str_detect(OWNER_NAME, "EMPLOYEES RETIREMENT") ~ 1,
                           str_detect(OWNER_NAME, "GIBB PROFIT SHARING PLAN") ~ 1,
                           str_detect(OWNER_NAME, "O SHAUGHNESSY CHRISTINE ANN") ~ 1,
                           str_detect(OWNER_NAME, "OLIVE ARCADE PLAZA VENTURE") ~ 1,
                           str_detect(OWNER_NAME, "SANDFOS FAMILY") ~ 1,
                           str_detect(OWNER_NAME, "TIMELY DISBURSEMENT PROFIT SHARING") ~ 1,
                           TRUE ~ 0),
         Bank = case_when(str_detect(OWNER_NAME, "MORTGAGE") ~ 1,
                          str_detect(OWNER_NAME, "BANK") ~ 1,
                          str_detect(OWNER_NAME, "MTGE") ~ 1, 
                          str_detect(OWNER_NAME, "CREDIT") ~ 1, 
                          str_detect(OWNER_NAME, "MUTUAL") ~ 1,
                          str_detect(OWNER_NAME, "AMERICAS WHOLESALE LENDER") ~ 1,
                          str_detect(OWNER_NAME, "AURORA LOAN SERVICES") ~ 1,
                          str_detect(OWNER_NAME, "FIDELITY FINANCIAL") ~ 1,
                          str_detect(OWNER_NAME, "GRAVOIS HOME SAVINGS") ~ 1,
                          str_detect(OWNER_NAME, "HOME FED SAV") ~ 1,
                          str_detect(OWNER_NAME, "HOME FED SAVINGS") ~ 1,
                          str_detect(OWNER_NAME, "HOME FEDERAL SAVINGS") ~ 1,
                          str_detect(OWNER_NAME, "HOMESIDE LENDING") ~ 1,
                          str_detect(OWNER_NAME, "JEFFERSON SAVINGS") ~ 1,
                          str_detect(OWNER_NAME, "MASON SECURITIES") ~ 1,
                          str_detect(OWNER_NAME, "PUBLIC SERVICE SAVINGS") ~ 1,
                          str_detect(OWNER_NAME, "TCF FINANCIAL SERVICES") ~ 1,
                          TRUE ~ 0),
         Instit = case_when(str_detect(OWNER_NAME, "CHURCH") ~ 1,
                            str_detect(OWNER_NAME, "CHUR") ~ 1,
                            str_detect(OWNER_NAME, "FELLOWSHIP") ~ 1,
                            str_detect(OWNER_NAME, "BAPTIST") ~ 1,
                            str_detect(OWNER_NAME, "SCHOOL SISTERS") ~ 1,
                            str_detect(OWNER_NAME, "FOUNDATION") ~ 1,
                            str_detect(OWNER_NAME, "HOME CARE") ~ 1,
                            str_detect(OWNER_NAME, "ARCHBISHOP") ~ 1,
                            str_detect(OWNER_NAME, "UNIVERSITY") ~ 1,
                            str_detect(OWNER_NAME, "CHRISTIAN ASSEMBLY") ~ 1,
                            str_detect(OWNER_NAME, "CHRISTIAN ACADEMY") ~ 1,
                            str_detect(OWNER_NAME, "CROWN OF GLORY CHRISTIAN REDEEMING") ~ 1,
                            str_detect(OWNER_NAME, "LODGE") ~ 1,
                            str_detect(OWNER_NAME, "EVANGELICAL") ~ 1,
                            str_detect(OWNER_NAME, "SCHOOL OF") ~ 1,
                            str_detect(OWNER_NAME, "ASSEMBLY OF GOD") ~ 1, 
                            str_detect(OWNER_NAME, "HEALTH CARE") ~ 1,
                            str_detect(OWNER_NAME, "SISTERS OF") ~ 1,
                            str_detect(OWNER_NAME, "MINISTRIES") ~ 1,
                            str_detect(OWNER_NAME, "SERVICE CENTER") ~ 1,
                            str_detect(OWNER_NAME, "SCHOOL ASSN") ~ 1,
                            str_detect(OWNER_NAME, "HABITAT FOR HUMANITY") ~ 1,
                            str_detect(OWNER_NAME, "ORTHODOX") ~ 1,
                            str_detect(OWNER_NAME, "APOSTOLIC") ~ 1,
                            str_detect(OWNER_NAME, "JEHOVAHS WITNESSES") ~ 1,
                            str_detect(OWNER_NAME, "HISTORCIAL") ~ 1,
                            str_detect(OWNER_NAME, "HISTORICAL") ~ 1,
                            str_detect(OWNER_NAME, "KOENIG ROBERT CHRISTIAN") ~ 1,
                            str_detect(OWNER_NAME, "CHRISTIAN LIFE") ~ 1,
                            str_detect(OWNER_NAME, "LUTHERAN") ~ 1,
                            str_detect(OWNER_NAME, "WORSHIP CEN") ~ 1,
                            str_detect(OWNER_NAME, "NATIONAL RESIDENTIAL NOMINEE SERVICES") ~ 1, 
                            str_detect(OWNER_NAME, "NEHEMIAH PROGRAM") ~ 1,
                            str_detect(OWNER_NAME, "MISSIONARY") ~ 1,
                            str_detect(OWNER_NAME, "FOR CHRIST") ~ 1,
                            str_detect(OWNER_NAME, "PRESBYTERIAN") ~ 1,
                            str_detect(OWNER_NAME, "PRIORY ") ~ 1,
                            str_detect(OWNER_NAME, "PROJECT OUTREACH") ~ 1,
                            str_detect(OWNER_NAME, "RADIANT LIGHT ASSEMBLY") ~ 1,
                            str_detect(OWNER_NAME, "SALVATION") ~ 1,
                            str_detect(OWNER_NAME, "SHRINERS") ~ 1,
                            str_detect(OWNER_NAME, "HEALTH CARE") ~ 1,
                            str_detect(OWNER_NAME, "UNITED SUPPORTIVE") ~ 1,
                            str_detect(OWNER_NAME, "URBAN LEAGUE") ~ 1,
                            str_detect(OWNER_NAME, "PARK CHAPEL") ~ 1,
                            str_detect(OWNER_NAME, "METHODIST") ~ 1,
                            str_detect(OWNER_NAME, "CHRISTIAN CENTER") ~ 1,
                            str_detect(OWNER_NAME, "BEYOND HOUSING") ~ 1,
                            str_detect(OWNER_NAME, "JESUS CHRIST") ~ 1,
                            str_detect(OWNER_NAME, "BI STATE DEV") ~ 1,
                            str_detect(OWNER_NAME, "BI-STATE DEV AGENCY MO-IL METRO DIST") ~ 1,
                            str_detect(OWNER_NAME, "BISTATE DEV AGENCY MO IL METROPOLITAN") ~ 1,
                            str_detect(OWNER_NAME, "MEDICAL") ~ 1,
                            str_detect(OWNER_NAME, "DAUGHTERS AMER REVOL") ~ 1,
                            str_detect(OWNER_NAME, "DONALD DANFORTH PLANT") ~ 1,
                            str_detect(OWNER_NAME, "EQUITABLE LIFE") ~ 1,
                            str_detect(OWNER_NAME, "FORTRESS ORTREACH") ~ 1,
                            str_detect(OWNER_NAME, "FORTRESS OUTREACH") ~ 1,
                            str_detect(OWNER_NAME, "GEN GEORGE C MARSHALL MEM POST") ~ 1,
                            str_detect(OWNER_NAME, "SHIA ISLAMIC EDUCATION ") ~ 1,
                            str_detect(OWNER_NAME, "ADORERS OF THE BLOOD OF CHRIST") ~ 1,
                            str_detect(OWNER_NAME, "BARNES HOSPITAL") ~ 1,
                            str_detect(OWNER_NAME, "BERMUDA BIBLE HALL") ~ 1,
                            str_detect(OWNER_NAME, "BETHESDA GENERAL HOSPITAL") ~ 1,
                            str_detect(OWNER_NAME, "BJC HEALTH SYSTEM") ~ 1,
                            str_detect(OWNER_NAME, "HOSPITAL") ~ 1,
                            str_detect(OWNER_NAME, "ST JOHNS LUTHERN") ~ 1,
                            str_detect(OWNER_NAME, "ST JOHNS MERCY HEALTH") ~ 1,
                            str_detect(OWNER_NAME, "ST JOSEPH HOSPITAL") ~ 1,
                            str_detect(OWNER_NAME, "ST JOSEPH INSTITUTE") ~ 1,
                            str_detect(OWNER_NAME, "ST MARTINS CHILD CENTER") ~ 1,
                            str_detect(OWNER_NAME, "ST MARYS INSTITUTE") ~ 1,
                            str_detect(OWNER_NAME, "ST PAULS LUTH") ~ 1,
                            str_detect(OWNER_NAME, "UNITED METH ") ~ 1,
                            str_detect(OWNER_NAME, "CATHOLIC") ~ 1,
                            str_detect(OWNER_NAME, "CENTRAL INSTITUTE FOR THE DEAF") ~ 1,
                            str_detect(OWNER_NAME, "CHESTERFIELD MEMORIAL") ~ 1,
                            str_detect(OWNER_NAME, "CHILDREN'S WORLD LEARNING") ~ 1,
                            str_detect(OWNER_NAME, "CRAFT ALLIANCE EDUCATION") ~ 1,
                            str_detect(OWNER_NAME, "CRESTWOOD ALLIANCE") ~ 1,
                            str_detect(OWNER_NAME, "GRACE WORLD") ~ 1,
                            str_detect(OWNER_NAME, "HIGHER EDUCATION LOAN") ~ 1,
                            str_detect(OWNER_NAME, "HOPE EDUCATIONAL") ~ 1,
                            str_detect(OWNER_NAME, "INDUSTRIAL DEV") ~ 1,
                            str_detect(OWNER_NAME, "JEWISH CENTER FOR AGED") ~ 1,
                            str_detect(OWNER_NAME, "JUDEVINE CENTER") ~ 1,
                            str_detect(OWNER_NAME, "UNION NORTH AMERICA") ~ 1,
                            str_detect(OWNER_NAME, "LATTER DAY SAINTS") ~ 1,
                            str_detect(OWNER_NAME, "LIFE IS FOR EVERYONE") ~ 1,
                            str_detect(OWNER_NAME, "LIGHTHOUSE FOR THE BLIND") ~ 1,
                            str_detect(OWNER_NAME, "MID AMERICA TRANSPLANT") ~ 1,
                            str_detect(OWNER_NAME, "MID EAST AREA AGENCY ON AGING") ~ 1,
                            str_detect(OWNER_NAME, "MIZPAH") ~ 1,
                            str_detect(OWNER_NAME, "MOOG ORAL SCHOOL") ~ 1,
                            str_detect(OWNER_NAME, "NEW MOUNT SINAI") ~ 1,
                            str_detect(OWNER_NAME, "NORTH AMERICAN MONTESSORI") ~ 1,
                            str_detect(OWNER_NAME, "NORTHSIDE CHRISTN") ~ 1,
                            str_detect(OWNER_NAME, "NORTHSIDE YOUTH") ~ 1,
                            str_detect(OWNER_NAME, "NURSING CENTER") ~ 1,
                            str_detect(OWNER_NAME, "OLIVE CHAPEL AFRICAN") ~ 1,
                            str_detect(OWNER_NAME, "PI BETA PHI") ~ 1,
                            str_detect(OWNER_NAME, "POND ATHLETIC") ~ 1,
                            str_detect(OWNER_NAME, "PRIMITIVE BAPT CH") ~ 1,
                            str_detect(OWNER_NAME, "SISTERS ST MARY") ~ 1,
                            str_detect(OWNER_NAME, "BIOSCIENCES LABORATORIES") ~ 1,
                            str_detect(OWNER_NAME, "SOUTHERN MO DIST") ~ 1,
                            str_detect(OWNER_NAME, "SUPPORT SYSTEMS") ~ 1,
                            str_detect(OWNER_NAME, "UNITED WORKERS") ~ 1,
                            str_detect(OWNER_NAME, "UNITY HEALTH SYSTEM") ~ 1,
                            str_detect(OWNER_NAME, "VICTORY CHRISTIAN OUTREACH CENTER") ~ 1,
                            str_detect(OWNER_NAME, "WASHINGTON PROFESSIONAL ARTS") ~ 1,
                            str_detect(OWNER_NAME, "WASHINGTON PARK CEMETERY") ~ 1,
                            str_detect(OWNER_NAME, "YOUNG MENS CHRISTIAN") ~ 1,
                            str_detect(OWNER_NAME, "YOUNG WOMENS CHRISTIAN") ~ 1,
                            TRUE ~ 0),
         hoa = case_when(str_detect(OWNER_NAME, "HOMEOWNER") ~ 1,
                         str_detect(OWNER_NAME, "CONDOMINIUM") ~ 1,
                         str_detect(OWNER_NAME, "GOLFCLUB") ~ 1,
                         str_detect(OWNER_NAME, "CLUB") ~ 1,
                         str_detect(OWNER_NAME, "HOME OWNERS") ~ 1,
                         str_detect(OWNER_NAME, "ASSOCIATION") ~ 1,
                         str_detect(OWNER_NAME, "OWNERSASSOCIATION") ~ 1, 
                         str_detect(OWNER_NAME, "RESIDENTS ASS") ~ 1,
                         str_detect(OWNER_NAME, "WOODSRESIDENTSASSOC") ~ 1,
                         str_detect(OWNER_NAME, "ESTATES") ~ 1,
                         str_detect(OWNER_NAME, "OF GOVERNORS") ~ 1,
                         str_detect(OWNER_NAME, "OFGOVERNORS") ~ 1,
                         str_detect(OWNER_NAME, "APARTMENTS") ~ 1,
                         str_detect(OWNER_NAME, "NEIGHBORHOOD") ~ 1,
                         str_detect(OWNER_NAME, "ESTATES RESIDENTS") ~ 1,
                         str_detect(OWNER_NAME, "LAKES AT") ~ 1,
                         str_detect(OWNER_NAME, "MANORS OF") ~ 1,
                         str_detect(OWNER_NAME, "MANOR DIRECTORS") ~ 1,
                         str_detect(OWNER_NAME, "FORESTRESIDENTSASS") ~ 1,
                         str_detect(OWNER_NAME, "RESERVE AT") ~ 1,
                         str_detect(OWNER_NAME, "SUBDIVISION") ~ 1,
                         str_detect(OWNER_NAME, "SUGARTREE HOMES") ~ 1,
                         str_detect(OWNER_NAME, "HOMES ASS") ~ 1,
                         str_detect(OWNER_NAME, "DIRECTORS") ~ 1,
                         str_detect(OWNER_NAME, "VILLAGES AT") ~ 1, 
                         str_detect(OWNER_NAME, "VILLAS AT") ~ 1,
                         str_detect(OWNER_NAME, "APARTMNTS") ~ 1,
                         str_detect(OWNER_NAME, " PLAT ") ~ 1,
                         str_detect(OWNER_NAME, "CASA ROYALE") ~ 1,
                         str_detect(OWNER_NAME, "MAYER HOMES") ~ 1,
                         str_detect(OWNER_NAME, "ORTMANN OVERLAND HOME") ~ 1,
                         str_detect(OWNER_NAME, "R B PLATT HOMES") ~ 1,
                         str_detect(OWNER_NAME, "SHENANDOAH RESIDENT ASSOC") ~ 1,
                         str_detect(OWNER_NAME, "VASEL ACRES IMPROVEMENT ASSN") ~ 1,
                         str_detect(OWNER_NAME, "VILLAGE AT BARRINGTON") ~ 1,
                         str_detect(OWNER_NAME, "VILLAGE AT PADDOCK") ~ 1,
                         str_detect(OWNER_NAME, "VILLAGE THREE PKS") ~ 1,
                         str_detect(OWNER_NAME, "WEST LAKE ACRES FACILITIES ASSN") ~ 1,
                         str_detect(OWNER_NAME, "WOODCHASE PLAZA ASSOCS") ~ 1,
                         TRUE ~ 0),
         muni = case_when(str_detect(OWNER_NAME, "CITY OF") ~ 1,
                          str_detect(OWNER_NAME, "SCHOOL DISTRICT") ~ 1,
                          str_detect(OWNER_NAME, "SCHOOLDISTRICT") ~ 1,
                          str_detect(OWNER_NAME, "SCHOOL DIST") ~ 1,
                          str_detect(OWNER_NAME, "STATE OF") ~ 1, 
                          str_detect(OWNER_NAME, "VILLAGE OF") ~ 1,
                          str_detect(OWNER_NAME, "VILLIAGE OF") ~ 1,
                          str_detect(OWNER_NAME, "DEPT OF ") ~ 1,
                          str_detect(OWNER_NAME, "DEPARTMENT OF") ~ 1,
                          str_detect(OWNER_NAME, "PROTECTION DISTRICT") ~ 1,
                          str_detect(OWNER_NAME, "RECREATION") ~ 1,
                          str_detect(OWNER_NAME, "SEWER") ~ 1,
                          str_detect(OWNER_NAME, "TOWN OF") ~ 1,
                          str_detect(OWNER_NAME, "TRANSPORTATION") ~ 1,
                          str_detect(OWNER_NAME, "GREAT RIVERS GREENWAY") ~ 1,
                          str_detect(OWNER_NAME, "HOUSING AUTHORITY") ~ 1,
                          str_detect(OWNER_NAME, "LEVEE") ~ 1,
                          str_detect(OWNER_NAME, "OF ST LOUIS") ~ 1,
                          str_detect(OWNER_NAME, "LAND CLEARANCE") ~ 1,
                          str_detect(OWNER_NAME, "LEMAY CHILD & FAMILY CENTER") ~ 1,
                          str_detect(OWNER_NAME, "MISSOURI") ~ 1,
                          str_detect(OWNER_NAME, "R-2 FERGUSON REORGANIZEDSCH DIST") ~ 1,
                          str_detect(OWNER_NAME, "ST LOUIS") ~ 1,
                          str_detect(OWNER_NAME, "SEC VIL OF") ~ 1,
                          str_detect(OWNER_NAME, "UNITED STATES") ~ 1,
                          str_detect(OWNER_NAME, "VETERAN") ~ 1,
                          str_detect(OWNER_NAME, "CHESTERFIELD DAY SCHOOL") ~ 1,
                          str_detect(OWNER_NAME, "FIRE PROTECTION") ~ 1,
                          str_detect(OWNER_NAME, "CHESTERFIELD VALLEY CENTRE") ~ 1,
                          str_detect(OWNER_NAME, "CITIZENS FOR MODERN") ~ 1,
                          str_detect(OWNER_NAME, "FIRE PROT DIST") ~ 1,
                          str_detect(OWNER_NAME, "HOUSING & URBAN") ~ 1,
                          str_detect(OWNER_NAME, "JOHN BURROUGHS SCHOOL") ~ 1,
                          str_detect(OWNER_NAME, "LAND CLEAR") ~ 1,
                          str_detect(OWNER_NAME, "AMBULANCE DISTRICT") ~ 1,
                          str_detect(OWNER_NAME, "TERRACE FIRE") ~ 1,
                          str_detect(OWNER_NAME, "FIRE DIST") ~ 1,
                          str_detect(OWNER_NAME, "R-2 FERGUSON") ~ 1,
                          str_detect(OWNER_NAME, "SOUTH TRAILS SEC") ~ 1,
                          str_detect(OWNER_NAME, "STATE CA PUB EMLOYEES") ~ 1,
                          str_detect(OWNER_NAME, "STATE PF CA PUBLIC") ~ 1,
                          str_detect(OWNER_NAME, "UNITED POSTAL") ~ 1,
                          TRUE ~ 0),
         private = case_when(str_detect(OWNER_NAME, " H/W ") ~ 1,
                             str_detect(OWNER_NAME, " H/H ") ~ 1,
                             str_detect(OWNER_NAME, " HW ") ~ 1,
                             str_detect(OWNER_NAME, " HH ") ~ 1,
                             str_detect(OWNER_NAME, " SPOUSES ") ~ 1,
                             TRUE ~ 0)) %>%
  distinct(., LOCATOR, .keep_all = TRUE ) %>%
  arrange(PROP_ADD, .keep_all = TRUE)

assign(paste0("own_dat",i), own_dat)
}

y<-seq(2018,2020)

for(i in y){
  
  parcel <- read.csv(file=paste0("./Build/Data/", i, "/primary_parcel.csv"),
                     header = TRUE,
                     sep = "|",
                     quote = "", 
                     row.names = NULL, 
                     stringsAsFactors = FALSE)
  
  own_dat <- parcel %>%
    filter(CLASS == "R" & 
             LIVUNIT>0 ) %>%
    mutate(prop_add = paste(TAX_ADRNO, TAX_DIR, TAX_STREET, TAX_SUFFIX, sep = " "),
           prop_add = gsub("\\s+", " ", str_trim(prop_add)),
           own_add = paste(OWNER_ADRNO, OWNER_DIR, OWNER_STREET, OWNER_SUFFIX, sep = " "),
           own_add = gsub("NA", "", own_add),
           own_add = gsub("\\s+", " ", str_trim(own_add)),
           TENURE = case_when(prop_add == own_add ~ "OWNER",
                              prop_add != own_add ~ "NOT OWNER")) %>%
    filter(TENURE == "NOT OWNER") %>%
    select(PARID, OWN1, OWN2, own_add, OWNER_CITY, OWNER_STATE, OWNER_ZIP, prop_add, TAX_CITY, TAX_ZIP,
           CLASS, LUC, LIVUNIT, TENURE) %>%
    mutate(OWNER_NAME = OWN1) %>%
    mutate(OWNER_NAME = str_replace_all(OWNER_NAME, "L L C", "LLC"), 
           OWNER_NAME = str_replace_all(OWNER_NAME, "L    L    C", "LLC"), 
           OWNER_NAME = str_replace_all(OWNER_NAME, "L LC", "LLC"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "L C", "LLC"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "LL C", "LLC"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "J/T", "TRUST"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "L P", "LP"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "RD", "ROAD"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "SCHOOL SISTERSOF NOTRE DAME", "SCHOOL SISTERS OF NOTRE DAME"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "GOLF CLUB", "GOLFCLUB"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "PERS REP", "PERSONAL REPRESENTATIVE"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "VILLAGES OF", "VILLAGE OF"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "CITYOF", "CITY OF"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "GODTHE", "GOD THE"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "SALVATION ARMY CORPORATION ILLCORP", "SALVATION ARMY"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "CHURCH LLC", "CHURCH"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "A MISSOURI", "A MO"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "MISSOURI BANK", "MO BANK"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "MISSOURI BA", "MO BA"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "BANK OF ST LOUIS", "BANK OF STL"),
           OWNER_NAME = str_replace_all(OWNER_NAME, "LOAN CORP", "LOAN"),
           Corporate = case_when(str_detect(OWNER_NAME, "LLC") ~ 1,
                                 str_detect(OWNER_NAME, "INC") ~1,
                                 str_detect(OWNER_NAME, "LTD") ~1,
                                 str_detect(OWNER_NAME, "COMPANY") ~ 1,
                                 str_detect(OWNER_NAME, "RENTAL PROPERTY") ~ 1,
                                 str_detect(OWNER_NAME, "PROPERTY") ~ 1,
                                 str_detect(OWNER_NAME, "ACQUISITIONS") ~ 1,
                                 str_detect(OWNER_NAME, "PROPERTIES") ~ 1,
                                 str_detect(OWNER_NAME, "MANAGEMENT") ~ 1,
                                 str_detect(OWNER_NAME, "LC") ~ 1,
                                 str_detect(OWNER_NAME, "INVESTMENTS") ~ 1,
                                 str_detect(OWNER_NAME, "REALTY") ~ 1,
                                 str_detect(OWNER_NAME, "DEVELOPMENT") ~ 1,
                                 str_detect(OWNER_NAME, "EQUITY") ~ 1,
                                 str_detect(OWNER_NAME, "RENTALS") ~ 1,
                                 str_detect(OWNER_NAME, "CORP") ~ 1,
                                 str_detect(OWNER_NAME, "CO ") ~ 1,
                                 str_detect(OWNER_NAME, "REAL ESTATE") ~ 1,
                                 str_detect(OWNER_NAME, "CORPORATION") ~ 1,
                                 str_detect(OWNER_NAME, "ASHFIELD ACTIVE LIVING") ~ 1,
                                 str_detect(OWNER_NAME, "CASTLE POINT LIVING") ~ 1,
                                 str_detect(OWNER_NAME, "BRYANTS TOWING") ~ 1,
                                 str_detect(OWNER_NAME, "INVESTMENT") ~ 1,
                                 str_detect(OWNER_NAME, "LEASING") ~ 1,
                                 str_detect(OWNER_NAME, "INVESTORS") ~ 1,
                                 str_detect(OWNER_NAME, "ENTERPRISE") ~ 1,
                                 str_detect(OWNER_NAME, "REHAB") ~ 1,
                                 str_detect(OWNER_NAME, "PRECISION PLUMBING SOLUTIONS") ~ 1,
                                 str_detect(OWNER_NAME, "WIRELESS") ~ 1,
                                 str_detect(OWNER_NAME, "AERO CHARTER") ~ 1,
                                 str_detect(OWNER_NAME, "AMERITECH") ~ 1,
                                 str_detect(OWNER_NAME, "AUTOMATIC ICE SYSTEMS") ~ 1,
                                 str_detect(OWNER_NAME, "BABY HAVEN") ~ 1,
                                 str_detect(OWNER_NAME, "CENTURY ALARM") ~ 1,
                                 str_detect(OWNER_NAME, "CRESTWOOD EXECUTIVE CENTER") ~ 1,
                                 str_detect(OWNER_NAME, "DOUGLASS LAND LIMITED") ~ 1,
                                 str_detect(OWNER_NAME, "DRURY INN") ~ 1,
                                 str_detect(OWNER_NAME, "DUBLEN HOMES") ~ 1,
                                 str_detect(OWNER_NAME, "EDYS GRAND ICE CREAM") ~ 1,
                                 str_detect(OWNER_NAME, "EIGHTEEN INESTMENTS") ~ 1,
                                 str_detect(OWNER_NAME, "EVERGREEN EQUITIES") ~ 1,
                                 str_detect(OWNER_NAME, "HICKORY CREST") ~ 1,
                                 str_detect(OWNER_NAME, "NORTH MERAMEC") ~ 1,
                                 str_detect(OWNER_NAME, "CAR WASH") ~ 1,
                                 str_detect(OWNER_NAME, "CARWASH") ~ 1,
                                 str_detect(OWNER_NAME, "FOUR SEVENTY SEVEN") ~ 1,
                                 str_detect(OWNER_NAME, "GALE BUILDING & REMODELING") ~ 1,
                                 str_detect(OWNER_NAME, "ATLAS TRUCK SALES") ~ 1,
                                 str_detect(OWNER_NAME, "YOUDE FAMILY") ~ 1,
                                 str_detect(OWNER_NAME, "H & M MACHINE SERVICE") ~ 1,
                                 str_detect(OWNER_NAME, "HGS DESIGN LTD") ~ 1,
                                 str_detect(OWNER_NAME, "I-44 MARINE") ~ 1,
                                 str_detect(OWNER_NAME, "JIFFY LUBE") ~ 1,
                                 str_detect(OWNER_NAME, "KINGS FOOD MARKET") ~ 1,
                                 str_detect(OWNER_NAME, "LADUE INNERBELT EXECUTIVE CENTER") ~ 1,
                                 str_detect(OWNER_NAME, "LECHNER & LECHNER LTD") ~ 1,
                                 str_detect(OWNER_NAME, "CUSTOM HOMES") ~ 1,
                                 str_detect(OWNER_NAME, "LONE STAR STEAKHOUSE") ~ 1,
                                 str_detect(OWNER_NAME, "MIDAMERICA CENTER") ~ 1,
                                 str_detect(OWNER_NAME, "NORFOLK & WESTERN RAILROAD") ~ 1,
                                 str_detect(OWNER_NAME, "OUTDOOR SYSTEMS") ~ 1,
                                 str_detect(OWNER_NAME, "P & A DRYWALL SUPPLY") ~ 1,
                                 str_detect(OWNER_NAME, "PARK CRESTWOOD LTD") ~ 1,
                                 str_detect(OWNER_NAME, "PHOENIX INTERNATIONAL") ~ 1,
                                 str_detect(OWNER_NAME, "PHOENIX INTTERNATIONAL") ~ 1,
                                 str_detect(OWNER_NAME, "PINE LAWN DENTAL") ~ 1,
                                 str_detect(OWNER_NAME, "PIZZA INN") ~ 1,
                                 str_detect(OWNER_NAME, "PLEASANT HOLLOW LTD") ~ 1,
                                 str_detect(OWNER_NAME, "R MITCHELL RENOVATIONS") ~ 1,
                                 str_detect(OWNER_NAME, "RED LOBSTER INNS OF AMERICA") ~ 1,
                                 str_detect(OWNER_NAME, "SHERWOODS FOREST NURSERY") ~ 1,
                                 str_detect(OWNER_NAME, "SPRINT PCS") ~ 1,
                                 str_detect(OWNER_NAME, "REFUSE DISPOSAL SERVICE") ~ 1,
                                 str_detect(OWNER_NAME, "SUTTON RESOURCES LTD") ~ 1,
                                 str_detect(OWNER_NAME, "TOWNHOUSES LTD") ~ 1,
                                 str_detect(OWNER_NAME, "TUCKEY & ASSOCS PHYSICAL") ~ 1,
                                 str_detect(OWNER_NAME, "UNION PACIFIC SYSTEMS") ~ 1,
                                 str_detect(OWNER_NAME, "WINTER BROTHERS MATERIALS") ~ 1,
                                 str_detect(OWNER_NAME, "WOLFF SHOE MANUFACTURING") ~ 1,
                                 TRUE ~ 0),
           Partner = case_when(str_detect(OWNER_NAME, " PARTNER ") ~ 1,
                               str_detect(OWNER_NAME, " LP ") ~ 1,
                               str_detect(OWNER_NAME, "PTNSP ") ~ 1,
                               str_detect(OWNER_NAME, "GROUP") ~ 1,
                               str_detect(OWNER_NAME, "ASSOCIATES ") ~ 1, 
                               str_detect(OWNER_NAME, " BUILDERS ") ~ 1,
                               str_detect(OWNER_NAME, "JOINT VENTURE") ~ 1,
                               str_detect(OWNER_NAME, "CHARLOTTE FREDERICK FAMILY LIMITED") ~ 1,
                               str_detect(OWNER_NAME, "CLARKSON CLAYTON CEN") ~ 1,
                               str_detect(OWNER_NAME, "EQUITABLE-CROW MIDWEST") ~ 1,
                               str_detect(OWNER_NAME, "EQUITABLE CROW MIDWEST") ~ 1,
                               str_detect(OWNER_NAME, "HIGHLAND MINI STORAGE") ~ 1,
                               str_detect(OWNER_NAME, "UNDERTAKERS") ~ 1,
                               str_detect(OWNER_NAME, "KENNETH S ROTSKOFF FAMILY") ~ 1,
                               str_detect(OWNER_NAME, "MARY DIANE GOESSLING BRYAN FAMILY") ~ 1,
                               str_detect(OWNER_NAME, "MARYVILLE CENTRE HOTEL") ~ 1,
                               str_detect(OWNER_NAME, "TERRA VENTURE BRIDGETON PROJECT") ~ 1,
                               TRUE ~ 0),
           Trust = case_when(str_detect(OWNER_NAME, "TRUST") ~ 1,
                             str_detect(OWNER_NAME, "TRS") ~ 1,
                             str_detect(OWNER_NAME, "REVOCABLE") ~ 1,
                             str_detect(OWNER_NAME, "IRREVOC") ~ 1,
                             str_detect(OWNER_NAME, "REVOC") ~ 1,
                             str_detect(OWNER_NAME, "ESTATE OF") ~ 1,
                             str_detect(OWNER_NAME, "\\s ITAF \\s") ~ 1,
                             str_detect(OWNER_NAME, "FUND") ~ 1,
                             str_detect(OWNER_NAME, "INDENTURE") ~ 1,
                             str_detect(OWNER_NAME, "PERSONAL REPRESENTATIVE") ~ 1,
                             str_detect(OWNER_NAME, "HEIRS OF") ~ 1,
                             str_detect(OWNER_NAME, "EMPLOYEESRETIREMENT") ~ 1,
                             str_detect(OWNER_NAME, "EMPLOYEES RETIREMENT") ~ 1,
                             str_detect(OWNER_NAME, "GIBB PROFIT SHARING PLAN") ~ 1,
                             str_detect(OWNER_NAME, "O SHAUGHNESSY CHRISTINE ANN") ~ 1,
                             str_detect(OWNER_NAME, "OLIVE ARCADE PLAZA VENTURE") ~ 1,
                             str_detect(OWNER_NAME, "SANDFOS FAMILY") ~ 1,
                             str_detect(OWNER_NAME, "TIMELY DISBURSEMENT PROFIT SHARING") ~ 1,
                             TRUE ~ 0),
           Bank = case_when(str_detect(OWNER_NAME, "MORTGAGE") ~ 1,
                            str_detect(OWNER_NAME, "BANK") ~ 1,
                            str_detect(OWNER_NAME, "MTGE") ~ 1, 
                            str_detect(OWNER_NAME, "CREDIT") ~ 1, 
                            str_detect(OWNER_NAME, "MUTUAL") ~ 1,
                            str_detect(OWNER_NAME, "AMERICAS WHOLESALE LENDER") ~ 1,
                            str_detect(OWNER_NAME, "AURORA LOAN SERVICES") ~ 1,
                            str_detect(OWNER_NAME, "FIDELITY FINANCIAL") ~ 1,
                            str_detect(OWNER_NAME, "GRAVOIS HOME SAVINGS") ~ 1,
                            str_detect(OWNER_NAME, "HOME FED SAV") ~ 1,
                            str_detect(OWNER_NAME, "HOME FED SAVINGS") ~ 1,
                            str_detect(OWNER_NAME, "HOME FEDERAL SAVINGS") ~ 1,
                            str_detect(OWNER_NAME, "HOMESIDE LENDING") ~ 1,
                            str_detect(OWNER_NAME, "JEFFERSON SAVINGS") ~ 1,
                            str_detect(OWNER_NAME, "MASON SECURITIES") ~ 1,
                            str_detect(OWNER_NAME, "PUBLIC SERVICE SAVINGS") ~ 1,
                            str_detect(OWNER_NAME, "TCF FINANCIAL SERVICES") ~ 1,
                            TRUE ~ 0),
           Instit = case_when(str_detect(OWNER_NAME, "CHURCH") ~ 1,
                              str_detect(OWNER_NAME, "CHUR") ~ 1,
                              str_detect(OWNER_NAME, "FELLOWSHIP") ~ 1,
                              str_detect(OWNER_NAME, "BAPTIST") ~ 1,
                              str_detect(OWNER_NAME, "SCHOOL SISTERS") ~ 1,
                              str_detect(OWNER_NAME, "FOUNDATION") ~ 1,
                              str_detect(OWNER_NAME, "HOME CARE") ~ 1,
                              str_detect(OWNER_NAME, "ARCHBISHOP") ~ 1,
                              str_detect(OWNER_NAME, "UNIVERSITY") ~ 1,
                              str_detect(OWNER_NAME, "CHRISTIAN ASSEMBLY") ~ 1,
                              str_detect(OWNER_NAME, "CHRISTIAN ACADEMY") ~ 1,
                              str_detect(OWNER_NAME, "CROWN OF GLORY CHRISTIAN REDEEMING") ~ 1,
                              str_detect(OWNER_NAME, "LODGE") ~ 1,
                              str_detect(OWNER_NAME, "EVANGELICAL") ~ 1,
                              str_detect(OWNER_NAME, "SCHOOL OF") ~ 1,
                              str_detect(OWNER_NAME, "ASSEMBLY OF GOD") ~ 1, 
                              str_detect(OWNER_NAME, "HEALTH CARE") ~ 1,
                              str_detect(OWNER_NAME, "SISTERS OF") ~ 1,
                              str_detect(OWNER_NAME, "MINISTRIES") ~ 1,
                              str_detect(OWNER_NAME, "SERVICE CENTER") ~ 1,
                              str_detect(OWNER_NAME, "SCHOOL ASSN") ~ 1,
                              str_detect(OWNER_NAME, "HABITAT FOR HUMANITY") ~ 1,
                              str_detect(OWNER_NAME, "ORTHODOX") ~ 1,
                              str_detect(OWNER_NAME, "APOSTOLIC") ~ 1,
                              str_detect(OWNER_NAME, "JEHOVAHS WITNESSES") ~ 1,
                              str_detect(OWNER_NAME, "HISTORCIAL") ~ 1,
                              str_detect(OWNER_NAME, "HISTORICAL") ~ 1,
                              str_detect(OWNER_NAME, "KOENIG ROBERT CHRISTIAN") ~ 1,
                              str_detect(OWNER_NAME, "CHRISTIAN LIFE") ~ 1,
                              str_detect(OWNER_NAME, "LUTHERAN") ~ 1,
                              str_detect(OWNER_NAME, "WORSHIP CEN") ~ 1,
                              str_detect(OWNER_NAME, "NATIONAL RESIDENTIAL NOMINEE SERVICES") ~ 1, 
                              str_detect(OWNER_NAME, "NEHEMIAH PROGRAM") ~ 1,
                              str_detect(OWNER_NAME, "MISSIONARY") ~ 1,
                              str_detect(OWNER_NAME, "FOR CHRIST") ~ 1,
                              str_detect(OWNER_NAME, "PRESBYTERIAN") ~ 1,
                              str_detect(OWNER_NAME, "PRIORY ") ~ 1,
                              str_detect(OWNER_NAME, "PROJECT OUTREACH") ~ 1,
                              str_detect(OWNER_NAME, "RADIANT LIGHT ASSEMBLY") ~ 1,
                              str_detect(OWNER_NAME, "SALVATION") ~ 1,
                              str_detect(OWNER_NAME, "SHRINERS") ~ 1,
                              str_detect(OWNER_NAME, "HEALTH CARE") ~ 1,
                              str_detect(OWNER_NAME, "UNITED SUPPORTIVE") ~ 1,
                              str_detect(OWNER_NAME, "URBAN LEAGUE") ~ 1,
                              str_detect(OWNER_NAME, "PARK CHAPEL") ~ 1,
                              str_detect(OWNER_NAME, "METHODIST") ~ 1,
                              str_detect(OWNER_NAME, "CHRISTIAN CENTER") ~ 1,
                              str_detect(OWNER_NAME, "BEYOND HOUSING") ~ 1,
                              str_detect(OWNER_NAME, "JESUS CHRIST") ~ 1,
                              str_detect(OWNER_NAME, "BI STATE DEV") ~ 1,
                              str_detect(OWNER_NAME, "BI-STATE DEV AGENCY MO-IL METRO DIST") ~ 1,
                              str_detect(OWNER_NAME, "BISTATE DEV AGENCY MO IL METROPOLITAN") ~ 1,
                              str_detect(OWNER_NAME, "MEDICAL") ~ 1,
                              str_detect(OWNER_NAME, "DAUGHTERS AMER REVOL") ~ 1,
                              str_detect(OWNER_NAME, "DONALD DANFORTH PLANT") ~ 1,
                              str_detect(OWNER_NAME, "EQUITABLE LIFE") ~ 1,
                              str_detect(OWNER_NAME, "FORTRESS ORTREACH") ~ 1,
                              str_detect(OWNER_NAME, "FORTRESS OUTREACH") ~ 1,
                              str_detect(OWNER_NAME, "GEN GEORGE C MARSHALL MEM POST") ~ 1,
                              str_detect(OWNER_NAME, "SHIA ISLAMIC EDUCATION ") ~ 1,
                              str_detect(OWNER_NAME, "ADORERS OF THE BLOOD OF CHRIST") ~ 1,
                              str_detect(OWNER_NAME, "BARNES HOSPITAL") ~ 1,
                              str_detect(OWNER_NAME, "BERMUDA BIBLE HALL") ~ 1,
                              str_detect(OWNER_NAME, "BETHESDA GENERAL HOSPITAL") ~ 1,
                              str_detect(OWNER_NAME, "BJC HEALTH SYSTEM") ~ 1,
                              str_detect(OWNER_NAME, "HOSPITAL") ~ 1,
                              str_detect(OWNER_NAME, "ST JOHNS LUTHERN") ~ 1,
                              str_detect(OWNER_NAME, "ST JOHNS MERCY HEALTH") ~ 1,
                              str_detect(OWNER_NAME, "ST JOSEPH HOSPITAL") ~ 1,
                              str_detect(OWNER_NAME, "ST JOSEPH INSTITUTE") ~ 1,
                              str_detect(OWNER_NAME, "ST MARTINS CHILD CENTER") ~ 1,
                              str_detect(OWNER_NAME, "ST MARYS INSTITUTE") ~ 1,
                              str_detect(OWNER_NAME, "ST PAULS LUTH") ~ 1,
                              str_detect(OWNER_NAME, "UNITED METH ") ~ 1,
                              str_detect(OWNER_NAME, "CATHOLIC") ~ 1,
                              str_detect(OWNER_NAME, "CENTRAL INSTITUTE FOR THE DEAF") ~ 1,
                              str_detect(OWNER_NAME, "CHESTERFIELD MEMORIAL") ~ 1,
                              str_detect(OWNER_NAME, "CHILDREN'S WORLD LEARNING") ~ 1,
                              str_detect(OWNER_NAME, "CRAFT ALLIANCE EDUCATION") ~ 1,
                              str_detect(OWNER_NAME, "CRESTWOOD ALLIANCE") ~ 1,
                              str_detect(OWNER_NAME, "GRACE WORLD") ~ 1,
                              str_detect(OWNER_NAME, "HIGHER EDUCATION LOAN") ~ 1,
                              str_detect(OWNER_NAME, "HOPE EDUCATIONAL") ~ 1,
                              str_detect(OWNER_NAME, "INDUSTRIAL DEV") ~ 1,
                              str_detect(OWNER_NAME, "JEWISH CENTER FOR AGED") ~ 1,
                              str_detect(OWNER_NAME, "JUDEVINE CENTER") ~ 1,
                              str_detect(OWNER_NAME, "UNION NORTH AMERICA") ~ 1,
                              str_detect(OWNER_NAME, "LATTER DAY SAINTS") ~ 1,
                              str_detect(OWNER_NAME, "LIFE IS FOR EVERYONE") ~ 1,
                              str_detect(OWNER_NAME, "LIGHTHOUSE FOR THE BLIND") ~ 1,
                              str_detect(OWNER_NAME, "MID AMERICA TRANSPLANT") ~ 1,
                              str_detect(OWNER_NAME, "MID EAST AREA AGENCY ON AGING") ~ 1,
                              str_detect(OWNER_NAME, "MIZPAH") ~ 1,
                              str_detect(OWNER_NAME, "MOOG ORAL SCHOOL") ~ 1,
                              str_detect(OWNER_NAME, "NEW MOUNT SINAI") ~ 1,
                              str_detect(OWNER_NAME, "NORTH AMERICAN MONTESSORI") ~ 1,
                              str_detect(OWNER_NAME, "NORTHSIDE CHRISTN") ~ 1,
                              str_detect(OWNER_NAME, "NORTHSIDE YOUTH") ~ 1,
                              str_detect(OWNER_NAME, "NURSING CENTER") ~ 1,
                              str_detect(OWNER_NAME, "OLIVE CHAPEL AFRICAN") ~ 1,
                              str_detect(OWNER_NAME, "PI BETA PHI") ~ 1,
                              str_detect(OWNER_NAME, "POND ATHLETIC") ~ 1,
                              str_detect(OWNER_NAME, "PRIMITIVE BAPT CH") ~ 1,
                              str_detect(OWNER_NAME, "SISTERS ST MARY") ~ 1,
                              str_detect(OWNER_NAME, "BIOSCIENCES LABORATORIES") ~ 1,
                              str_detect(OWNER_NAME, "SOUTHERN MO DIST") ~ 1,
                              str_detect(OWNER_NAME, "SUPPORT SYSTEMS") ~ 1,
                              str_detect(OWNER_NAME, "UNITED WORKERS") ~ 1,
                              str_detect(OWNER_NAME, "UNITY HEALTH SYSTEM") ~ 1,
                              str_detect(OWNER_NAME, "VICTORY CHRISTIAN OUTREACH CENTER") ~ 1,
                              str_detect(OWNER_NAME, "WASHINGTON PROFESSIONAL ARTS") ~ 1,
                              str_detect(OWNER_NAME, "WASHINGTON PARK CEMETERY") ~ 1,
                              str_detect(OWNER_NAME, "YOUNG MENS CHRISTIAN") ~ 1,
                              str_detect(OWNER_NAME, "YOUNG WOMENS CHRISTIAN") ~ 1,
                              TRUE ~ 0),
           hoa = case_when(str_detect(OWNER_NAME, "HOMEOWNER") ~ 1,
                           str_detect(OWNER_NAME, "CONDOMINIUM") ~ 1,
                           str_detect(OWNER_NAME, "GOLFCLUB") ~ 1,
                           str_detect(OWNER_NAME, "CLUB") ~ 1,
                           str_detect(OWNER_NAME, "HOME OWNERS") ~ 1,
                           str_detect(OWNER_NAME, "ASSOCIATION") ~ 1,
                           str_detect(OWNER_NAME, "OWNERSASSOCIATION") ~ 1, 
                           str_detect(OWNER_NAME, "RESIDENTS ASS") ~ 1,
                           str_detect(OWNER_NAME, "WOODSRESIDENTSASSOC") ~ 1,
                           str_detect(OWNER_NAME, "ESTATES") ~ 1,
                           str_detect(OWNER_NAME, "OF GOVERNORS") ~ 1,
                           str_detect(OWNER_NAME, "OFGOVERNORS") ~ 1,
                           str_detect(OWNER_NAME, "APARTMENTS") ~ 1,
                           str_detect(OWNER_NAME, "NEIGHBORHOOD") ~ 1,
                           str_detect(OWNER_NAME, "ESTATES RESIDENTS") ~ 1,
                           str_detect(OWNER_NAME, "LAKES AT") ~ 1,
                           str_detect(OWNER_NAME, "MANORS OF") ~ 1,
                           str_detect(OWNER_NAME, "MANOR DIRECTORS") ~ 1,
                           str_detect(OWNER_NAME, "FORESTRESIDENTSASS") ~ 1,
                           str_detect(OWNER_NAME, "RESERVE AT") ~ 1,
                           str_detect(OWNER_NAME, "SUBDIVISION") ~ 1,
                           str_detect(OWNER_NAME, "SUGARTREE HOMES") ~ 1,
                           str_detect(OWNER_NAME, "HOMES ASS") ~ 1,
                           str_detect(OWNER_NAME, "DIRECTORS") ~ 1,
                           str_detect(OWNER_NAME, "VILLAGES AT") ~ 1, 
                           str_detect(OWNER_NAME, "VILLAS AT") ~ 1,
                           str_detect(OWNER_NAME, "APARTMNTS") ~ 1,
                           str_detect(OWNER_NAME, " PLAT ") ~ 1,
                           str_detect(OWNER_NAME, "CASA ROYALE") ~ 1,
                           str_detect(OWNER_NAME, "MAYER HOMES") ~ 1,
                           str_detect(OWNER_NAME, "ORTMANN OVERLAND HOME") ~ 1,
                           str_detect(OWNER_NAME, "R B PLATT HOMES") ~ 1,
                           str_detect(OWNER_NAME, "SHENANDOAH RESIDENT ASSOC") ~ 1,
                           str_detect(OWNER_NAME, "VASEL ACRES IMPROVEMENT ASSN") ~ 1,
                           str_detect(OWNER_NAME, "VILLAGE AT BARRINGTON") ~ 1,
                           str_detect(OWNER_NAME, "VILLAGE AT PADDOCK") ~ 1,
                           str_detect(OWNER_NAME, "VILLAGE THREE PKS") ~ 1,
                           str_detect(OWNER_NAME, "WEST LAKE ACRES FACILITIES ASSN") ~ 1,
                           str_detect(OWNER_NAME, "WOODCHASE PLAZA ASSOCS") ~ 1,
                           TRUE ~ 0),
           muni = case_when(str_detect(OWNER_NAME, "CITY OF") ~ 1,
                            str_detect(OWNER_NAME, "SCHOOL DISTRICT") ~ 1,
                            str_detect(OWNER_NAME, "SCHOOLDISTRICT") ~ 1,
                            str_detect(OWNER_NAME, "SCHOOL DIST") ~ 1,
                            str_detect(OWNER_NAME, "STATE OF") ~ 1, 
                            str_detect(OWNER_NAME, "VILLAGE OF") ~ 1,
                            str_detect(OWNER_NAME, "VILLIAGE OF") ~ 1,
                            str_detect(OWNER_NAME, "DEPT OF ") ~ 1,
                            str_detect(OWNER_NAME, "DEPARTMENT OF") ~ 1,
                            str_detect(OWNER_NAME, "PROTECTION DISTRICT") ~ 1,
                            str_detect(OWNER_NAME, "RECREATION") ~ 1,
                            str_detect(OWNER_NAME, "SEWER") ~ 1,
                            str_detect(OWNER_NAME, "TOWN OF") ~ 1,
                            str_detect(OWNER_NAME, "TRANSPORTATION") ~ 1,
                            str_detect(OWNER_NAME, "GREAT RIVERS GREENWAY") ~ 1,
                            str_detect(OWNER_NAME, "HOUSING AUTHORITY") ~ 1,
                            str_detect(OWNER_NAME, "LEVEE") ~ 1,
                            str_detect(OWNER_NAME, "OF ST LOUIS") ~ 1,
                            str_detect(OWNER_NAME, "LAND CLEARANCE") ~ 1,
                            str_detect(OWNER_NAME, "LEMAY CHILD & FAMILY CENTER") ~ 1,
                            str_detect(OWNER_NAME, "MISSOURI") ~ 1,
                            str_detect(OWNER_NAME, "R-2 FERGUSON REORGANIZEDSCH DIST") ~ 1,
                            str_detect(OWNER_NAME, "ST LOUIS") ~ 1,
                            str_detect(OWNER_NAME, "SEC VIL OF") ~ 1,
                            str_detect(OWNER_NAME, "UNITED STATES") ~ 1,
                            str_detect(OWNER_NAME, "VETERAN") ~ 1,
                            str_detect(OWNER_NAME, "CHESTERFIELD DAY SCHOOL") ~ 1,
                            str_detect(OWNER_NAME, "FIRE PROTECTION") ~ 1,
                            str_detect(OWNER_NAME, "CHESTERFIELD VALLEY CENTRE") ~ 1,
                            str_detect(OWNER_NAME, "CITIZENS FOR MODERN") ~ 1,
                            str_detect(OWNER_NAME, "FIRE PROT DIST") ~ 1,
                            str_detect(OWNER_NAME, "HOUSING & URBAN") ~ 1,
                            str_detect(OWNER_NAME, "JOHN BURROUGHS SCHOOL") ~ 1,
                            str_detect(OWNER_NAME, "LAND CLEAR") ~ 1,
                            str_detect(OWNER_NAME, "AMBULANCE DISTRICT") ~ 1,
                            str_detect(OWNER_NAME, "TERRACE FIRE") ~ 1,
                            str_detect(OWNER_NAME, "FIRE DIST") ~ 1,
                            str_detect(OWNER_NAME, "R-2 FERGUSON") ~ 1,
                            str_detect(OWNER_NAME, "SOUTH TRAILS SEC") ~ 1,
                            str_detect(OWNER_NAME, "STATE CA PUB EMLOYEES") ~ 1,
                            str_detect(OWNER_NAME, "STATE PF CA PUBLIC") ~ 1,
                            str_detect(OWNER_NAME, "UNITED POSTAL") ~ 1,
                            TRUE ~ 0),
           private = case_when(str_detect(OWNER_NAME, " H/W ") ~ 1,
                               str_detect(OWNER_NAME, " H/H ") ~ 1,
                               str_detect(OWNER_NAME, " HW ") ~ 1,
                               str_detect(OWNER_NAME, " HH ") ~ 1,
                               str_detect(OWNER_NAME, " SPOUSES ") ~ 1,
                               TRUE ~ 0)) %>%
    mutate(key = private+muni+hoa+Instit+Bank+Trust+Partner+Corporate,
           private = case_when(key==0 ~ 1,
                               TRUE ~ private)) %>%
    distinct(., PARID, .keep_all = TRUE ) %>%
    arrange(prop_add, .keep_all = TRUE) %>%
    mutate(PARENT_LOC = PARID,
           LOCATOR = PARID)
  assign(paste0("own_dat",i), own_dat)
}

rm(i, own_dat, y, parcel)


save.image(file="./Build/Output/owners.RData")
